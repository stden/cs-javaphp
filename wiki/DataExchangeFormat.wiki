#summary Формат обмена данными с сервером
#labels Phase-Design,CSC

= Introduction =

DCES сервер работает в пассивном режиме: он принимает приходящие к нему запросы, выполняет их и отсылает ответ. Сам сервер не может инициировать действия.

Вместо ответа сервер может послать сообщение об ошибке.

= Соответствие между запросами и ответами =


Соответствие между запросами и ответами сервера приведено ниже. Во всех случаях вместо написанного в таблице ответа сервер может вернуть ошибку в `RequestFailedResponse`.

_(некоторые запросы, к сожалению, пока забыты. Например, нет запроса на удаление плагина сторны сервера. Также некоторые запросы пока не реализованы)_

|| *Запрос* || *Ответ* || *Пояснение* ||
||`AdjustContestRequest`||`AdjustContestResponse`|| Настроить соревноваие ||
||`AvailableContestsRequest`||`AvailableContestsResponse`|| Получить доступные соревнования ||
||`ConnectToContestRequest`||`ConnectToContestResponse`|| Подсоединиться к соревнованию||
||`CreateContestRequest`||`CreateContestResponse`|| Создать соревнование ||
||`DisconnectRequest`||`AcceptedResponse`|| Отсоединиться от соревнования ||
||`GetContestDataRequest`||`GetContestDataResponse`|| Узнать данные соревнования ||
||`GetUsersRequest`||`GetUsersResponse`|| Узнать пользователей соревнования ||
||`InstallClientPluginRequest`||`InstallClientPluginResponse`|| Скачать и установить плагин ||
||`RegisterToContestRequest`||`AcceptedResponse`|| Зарегистрироваться для участни||
||`RemoveClientPluginRequest`||`AcceptedResponse`|| Удалить плагин клиента ||
||`RestorePasswordRequest`||`AcceptedResponse`|| Восстановить пароль ||
||`SubmitSolutionRequest`||`SubmitSolutionResponse`|| Послать решение ||
||`CreateDataBaseRequest`||`AcceptedResponse`|| Создать базу данных ||
||`RemoveUserRequest`||`AcceptedResponse`|| Удалить пользователя ||
||`RemoveContestRequest`||`AcceptedResponse`|| Удалить соревноваие ||
||`AdjustClientPluginRequest`||`AcceptedResponse`|| Настроить плагин клиента ||
||`AdjustServerPluginRequest`||`AcceptedResponse`|| Настроить плагин сервера ||
||`GetContestResultsRequest`||`GetContestResultsResponse`|| Узнать результаты соревнования ||
||`StopContestRequest`||`AcceptedResponse`|| Остановить соревнование досрочно ||

== Формат запроса к сереверу ==
Запрос к серверу передается в POST запросе в формате
`x=[сериализованный php-класс с запросом]`. Таким образом, серверу достаточно проверить, что первые два символа запроса это `x=`, отбросить их, а весь остаток десериализовать php функцией `unserialize()`.

== Формат ответа сервера ==
Если произошла ошибка при обработке запроса, сервер создает объект `RequestFailedResponse`, заполняет его поля, сериализует и посылает ответ. Если ошибок не приозошло, сервер сериализует значение `null` (получается два символа `N;`), после этого сериализует объект с ответом сервера и посылает два сериализованных значения подряд.

Например, ответ AcceptedResponse будет передан как
{{{
N;O:16:"AcceptedResponse":0:{}
}}}
При анализе ответа сервера надо проверить первые два символа на `N;`. Если эти два символа найдены, то ошибки не произошло, символы надо отбросить и весь остаток ответа сервера является сериализованным php-объектом с результатом обработки запроса.

Если первые два символа другие, или символов меньше двух, то произошла ошибка, весь объект сервера необходимо десериализовать. Должен получиться `RequestFailedResponse` с описанием ошибки. Если десериализация не удалась, или получился другой объект, то либо возникли проблемы со связью, либо на сервере произошла серьезная ошибка, исправить которую может только разработчик.