#summary Формат представления задач в системе
#labels Featured,Phase-Design

= Введение =

Задача для системы проведения удаленных олимпиад - это набор файлов, упакованных в ZIP архив вместе с файлом манифеста, описывающим содержимое архива.
В общем случае задача может содержать следующие материалы:
 # условие (на естественном языке)
 # условие (формальное)
 # ответ (на естественном языке)
 # ответ (формальный)
 # ссылка на модуль ввода ответа
 # ссылка на модуль проверки решения
 # другое (например, исходные данные)

= Манифест =
Все файлы являются данными, смысл этих данных понимает только соответствующий программный модуль. Для 1, 3, 5, 6, 8 - это сама система проведения олимпиад.
2 - понимает только модуль ввода ответа, 4 - модуль проверки решения. 7 - понимает только модуль, с помощью которого была создана задача.

== Ресурсы ==
Задача является коллекцией ресурсов. Ресурсы - это все файлы архива, также ресурсы могут быть описаны в файле манифеста. В файле манифеста также хранится метаинформация для ресурсов.

Каждый ресурс имеет путь (path). Для файлов путь - это путь внутри архива, каталоги разделяет символ `/`. Например, ресурс `a.txt` - это файл, лежащий в корне архива, `folder/a.txt` - файл в каталоге `folder`.
Дополнительные ресурсы описываются тегами

{{{
<data path="...(путь)...">   (данные ресурса)   </data>
}}}

например, можно описать файл с ответом к задаче, которого нет в архиве. Считаем, что файла `answer.txt` нет в архиве, "создадим" этот файл, написав в нем 42:

{{{
<data path="answer.txt">42</data>
}}}

Вся информация о дополнительных ресурсах хранится в теге `resources`:

{{{
<resources>
    <data path="answer.txt">42</data>
    <data path="file.txt">239</data>
    ...
<resources>
}}}

== Метки ==
Чтобы система могла найти в архиве необходимые данные, некоторые ресурсы помечены метками, соответствующими смыслу ресурса (условие, формальное условие, ответ и т.п.) Метки могут соответствовать файлам или каталогам. Одной меткой можно пометить несколько ресурсов. Метка определяется тегом в `xml`. Например:

{{{
<statement-text path="statement.html" />
}}}

Здесь метка `statement-text` помечает файл `statement.html`. Ее смысл - "условие (на естественном языке)". Остальные метки:
 * `<statement>` формальное условие
 * `<answer-text>` ответ на естественном языке
 * `<answer>` формальный ответ.
 * `<input>` модуль ввода ответа
 * `<check>` модуль проверки решения
 * ... другие произвольные метки.

Метка помечает всегда один ресурс. Если метка помечает каталог, то ресурсы внутри каталога Не считаются помеченными этой меткой (см. ниже отличие поведения меток при определении ресурсов, недоступных участнику)

Все метки собраны в тег `<labels>`:

{{{
<labels>
    <statement-text path="statement.html" />
    <answer path="answer.txt" />
    ...
</labels>
}}}

== Ресурсы, не доступные участнику ==
Некоторые данные не должны быть доступны участнику, потому что в них содержится ответ или информация, помогающая найти ответ. Перечисленные выше метки уже определяют, можно ли давать участнику соответствующие ресурсы. `<statement>`, `<statement-text>`, `<input>`, `<check>` всегда доступны участнику. Любые другие метки помечают ресурсы, недоступные участнику. Чтобы переопределить это поведение, ресурс надо дополнительно пометить меткой `<participant>`.
Если каталог доступен/не доступен участнику, то все ресурсы внутри каталога также доступны/недоступны участнику. В случае противоречия используется та метка, которая ближе к ресурсу. Например, если файл `folder/file.txt` помечен `<participant>`, а каталог `folder/` помечен `<answer>`, то вся информация из каталога `folder/` участнику недоступна, но `file.txt` - исключение. Если один и тот же ресурс помечен сразу несколькими противоречивыми метками, то ресурс считается доступным участнику, только если одна из меток - `<participant>`.

== Файла манифеста ==
Файл манифеста называется MANIFEST и лежит в корне архива. Он имеет основной тег `<problem-description>` и два подтега `<resources>` и `<labels>`

{{{
<problem-description>
    <resources>
        <data path="answer.txt">42</data>
        <data path="file.txt">239</data>
        ...
    <resources>
    <labels>
        <statement-text path="statement.html" />
        <answer path="answer.txt" />
        ...
    </labels>
</problem-description>
}}}

==Безымянные ресурсы==

В некоторых случаях разделение записи о данных и их метки является лишним. Например, бессмысленно придумывать название файлу `answer.txt` только для того чтобы записать туда `42` и пометить его меткой `<answer>`. В этом случае можно использовать безымянные ресурсы, которые описаны в разделе ресурсов, но вместо пути к ним описана метка:

{{{
<problem-description>
    <resources>
        ...
        <data label="answer">42</data>        
        ...
    <resources>
    <labels>
        ...
        <!-- Здесь не описывается answer.txt -->
        ...
    </labels>
</problem-description>
}}}

Если путь к файлу все-таки описать нужно, он может быть указан вместе с меткой:

{{{
<problem-description>
    <resources>
        ...
        <data label="answer" path="answer1.txt">42</data>
        <data label="answer" path="answer2.txt">239</data>
        ...
    <resources>
    <labels>
        ...
        <!-- Здесь не описываются answer.txt -->
        ...
    </labels>
</problem-description>
}}}

Если в разделе `<resources>` ресурс необходимо пометить несколькими метками, они перечисляются через запятую в аргументе `label`. В разделе `<labels>` один ресурс можно помечать метками несколько раз.

==Интерфейс внешней программы==
Программа, которая использует описанные подобным образом задачи, имеет к ним доступ на основе следующих методов
 * перечислить пути ресурсов с данной меткой
 * получить файл с данным путем
 * убрать из задачи все ресурсы, недоступные участнику